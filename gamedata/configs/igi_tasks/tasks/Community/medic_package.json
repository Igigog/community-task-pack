{
	"WTF_VERSION": "4.0",
	"icon": "ui_iconsTotal_artefact",
	"preconditions": [
		"$ db.actor:community_goodwill(|CACHE.tg_community|) >= 700",
        "$ false"
	],
	"entities": [
        {
            "ids": "$ igi_finder.get_smarts(1,1)",
            "ids_used": "$ igi_utils.get_random_items(|this.ids|, 2)",
            "id": "$ |this.ids_used|[1]",
            "name": "$ alife_object(|this.id|):name()",
            "link_id": "smart"
        },

        {
            "id": "$ |smart.ids_used|[2]",
            "name": "$ alife_object(|this.id|):name()",
            "link_id": "decoy_smart",
            "to_description": true
        },

        {
            "faction":"$ igi_macros.Faction(|CACHE.task_giver_id|, 'enemy of actor and enemy of taskgiver')",
            "section_name":"$ |this.faction| .. '_sim_squad_advanced'",
            "id": "1$ |CACHE.squad_dead| and utils_obj.create_squad(|this.section_name|, |smart.name|).id",
            "init": "1$ |CACHE.squad_dead| and igi_helper.init_squad(|this.id|)",
            "commander_id": "1$ |CACHE.squad_dead| and alife_object(|this.id|):commander_id()",

            "link_id": "attacker_squad",
            "to_description": true
        },

        {
            "faction":"$ igi_macros.Faction(|CACHE.task_giver_id|, 'enemy of actor and enemy of taskgiver')",
            "section_name":"$ |this.faction| .. '_sim_squad_advanced'",
            "smart_name": "$ |CACHE.squad_dead| and |decoy_smart.name| or |smart.name|",
            "id": "1$ utils_obj.create_squad(|this.section_name|, |this.smart_name|).id",
            "init": "1$ igi_helper.init_squad(|this.id|)",
            "commander_id": "1$ alife_object(|this.id|):commander_id()",

            "link_id": "squad",
            "to_description": true
        },

        {
            "id": "1$ |squad.id|",
            "commander_id": "1$ alife_object(|this.id|):commander_id()",
            "actions": [{
                "when": "@$ |CACHE.squad_dead| and get_object_by_id(|this.commander_id|) ~= nil",
                "run": "@$ igi_generic_task.process_macros(|CACHE.task_id|, 'kill_squad') and false"
            }],

            "killed_ids": "kill_squad$ wtf_community_tasks.kill_squad(|this.id|)",
            "release": "on_finish$ |CACHE.squad_dead| and wtf_community_tasks.let_release(|this.killed_ids|)"
        },

        {
            "section_name":"broken_pda",
            "id": "1$ |CACHE.squad_dead| and alife_create_item(|this.section_name|, alife_object(|squad.commander_id|)).id",
            "CONTROLLER": "@$ |CACHE.squad_dead| and igi_target_return.Return or {}",
            "link_id": "pda"
        },

        {
            "section_name":"special_delivery_case",
            "id": "1$ alife_create_item(|this.section_name|, alife_object(|attacker_squad.commander_id|)).id",
            "CONTROLLER": "@$ igi_target_return.Return",
            "link_id": "package"
        }
	],
	"quest_givers": [
		{"Mercenary": true, "Medic": true}
	],
	"rewarder": "@$ igi_rewards.Static({money = 10000, goodwill = 50})",

    "tg_community": "$ igi_helper.get_community_by_id(|CACHE.task_giver_id|)",
    "squad_dead": "$ igi_random.rand() < 0.5",
    "notify_squad_dead": "$ igi_helper.trace_error('Squad dead: ' .. tostring(|CACHE.squad_dead|)) or 1"
}